---
import FullWidth from '@/layouts/FullWidth.astro';
import { SITE_CONFIG } from '@/constants';
import { getPopularCategories, getPopularTags } from '@/utils/posts';

// Get the current URL to provide context
const currentPath = Astro.url.pathname;

// Check if this looks like a tag or category URL
const isTagUrl = currentPath.startsWith('/tag/');
const isCategoryUrl = currentPath.startsWith('/category/');

let suggestedPath = '';
let errorType = 'page';

if (isTagUrl) {
	errorType = 'tag';
	suggestedPath = currentPath.replace('/tag/', '');
} else if (isCategoryUrl) {
	errorType = 'category';
	suggestedPath = currentPath.replace('/category/', '');
}

const popularCategories = await getPopularCategories()
  .then(items => items.sort((a, b) => b.count - a.count).splice(0, 5))

const popularTags = await getPopularTags()
  .then(items => items.sort((a, b) => b.count - a.count).splice(0, 5))

const title = "Page Not Found";
const description = `The page you're looking for doesn't exist on ${SITE_CONFIG.title}`;

---

<FullWidth title={title} description={description}>
  <div class="flex-1 flex items-center justify-center">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 text-center">
      <!-- 404 Icon -->
      <div class="mb-8">
        <svg class="mx-auto h-24 w-24 text-gray-400 dark:text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6-4h6m2 5.291A7.962 7.962 0 0112 15c-2.34 0-4.47-.881-6.08-2.33M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
      </div>

      <!-- Error Message -->
      <h1 class="text-6xl font-bold text-gray-900 dark:text-white mb-4">
        404
      </h1>

      <h2 class="text-3xl font-semibold text-gray-900 dark:text-white mb-4">
        {errorType === 'tag' && `Tag "${suggestedPath}" not found`}
        {errorType === 'category' && `Category "${suggestedPath}" not found`}
        {errorType === 'page' && "Haven't had that thought yet"}
      </h2>

      <p class="text-xl text-gray-600 dark:text-gray-300 mb-8 max-w-2xl mx-auto">
        {errorType === 'tag' && `The tag "${suggestedPath}" doesn't exist. Check the spelling or browse all available tags.`}
        {errorType === 'category' && `The category "${suggestedPath}" doesn't exist. Check the spelling or browse all available categories.`}
        {errorType === 'page' && "Not sure what you're looking for here. Maybe I haven't written about that topic yet, or perhaps you've stumbled into a corner of my brain that's still empty."}
      </p>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12">
        <a
          href="/"
          class="inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors"
        >
          Go Home
        </a>
        <a
          href="/blog"
          class="inline-flex items-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
        >
          Browse Blog
        </a>
        <a
          href="/about"
          class="inline-flex items-center px-6 py-3 border border-gray-300 dark:border-gray-600 text-base font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors"
        >
          About Me
        </a>
      </div>

      <!-- Helpful Links -->
      <div class="border-t border-gray-200 dark:border-gray-700 pt-8">
        <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4">
          Looking for something specific?
        </h3>

        <!-- "Popular Categories" list -->

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto">
          <div class="text-left pl-16">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">Popular Categories</h4>
            <ul class="space-y-1 text-sm text-gray-600 dark:text-gray-300">
              {popularCategories.map((category) => (
                <li><a href={category.url} class="hover:text-blue-600 dark:hover:text-blue-400">{category.name}</a></li>
              ))}
            </ul>
          </div>

          <!-- "Popular Tags" list  -->

          <div class="text-left pl-16">
            <h4 class="font-medium text-gray-900 dark:text-white mb-2">Popular Tags</h4>
            <ul class="space-y-1 text-sm text-gray-600 dark:text-gray-300">
              {popularTags.map((tag) => (
                <li><a href={tag.url} class="hover:text-blue-600 dark:hover:text-blue-400">#{tag.name}</a></li>
              ))}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</FullWidth>